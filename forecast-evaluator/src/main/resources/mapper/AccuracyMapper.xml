<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cz.savic.weatherevaluator.forecastevaluator.persistence.mapper.AccuracyMapper">

    <!-- Insert single hourly accuracy record -->
    <insert id="insertHourlyAccuracy" parameterType="HourlyAccuracyEntity">
        INSERT INTO accuracy_hourly
        (source, location_name, latitude, longitude, forecast_time_utc, target_datetime_utc, forecast_horizon,
         temperature_mae, temperature_bias, precipitation_mae, precipitation_bias, wind_speed_mae, wind_speed_bias)
        VALUES
        (#{source}, #{locationName}, #{latitude}, #{longitude}, #{forecastTimeUtc}, #{targetDatetimeUtc}, #{forecastHorizon},
         #{temperatureMae}, #{temperatureBias}, #{precipitationMae}, #{precipitationBias}, #{windSpeedMae}, #{windSpeedBias})
    </insert>

    <!-- Batch insert hourly accuracy records -->
    <insert id="insertHourlyAccuracyBatch" parameterType="java.util.List">
        INSERT INTO accuracy_hourly
        (source, location_name, latitude, longitude, forecast_time_utc, target_datetime_utc, forecast_horizon,
         temperature_mae, temperature_bias, precipitation_mae, precipitation_bias, wind_speed_mae, wind_speed_bias)
        VALUES
        <foreach collection="list" item="entity" separator=",">
            (#{entity.source}, #{entity.locationName}, #{entity.latitude}, #{entity.longitude},
             #{entity.forecastTimeUtc}, #{entity.targetDatetimeUtc}, #{entity.forecastHorizon},
             #{entity.temperatureMae}, #{entity.temperatureBias}, #{entity.precipitationMae},
             #{entity.precipitationBias}, #{entity.windSpeedMae}, #{entity.windSpeedBias})
        </foreach>
    </insert>

    <!-- Insert single daily accuracy record -->
    <insert id="insertDailyAccuracy" parameterType="DailyAccuracyEntity">
        INSERT INTO accuracy_daily
        (source, location_name, latitude, longitude, forecast_time_utc, target_date, forecast_horizon,
         temperature_min_mae, temperature_max_mae, temperature_mean_mae,
         temperature_min_bias, temperature_max_bias, temperature_mean_bias,
         precipitation_mae, precipitation_bias, wind_speed_mae, wind_speed_bias)
        VALUES
        (#{source}, #{locationName}, #{latitude}, #{longitude}, #{forecastTimeUtc}, #{targetDate}, #{forecastHorizon},
         #{temperatureMinMae}, #{temperatureMaxMae}, #{temperatureMeanMae},
         #{temperatureMinBias}, #{temperatureMaxBias}, #{temperatureMeanBias},
         #{precipitationMae}, #{precipitationBias}, #{windSpeedMae}, #{windSpeedBias})
    </insert>

    <!-- Batch insert daily accuracy records -->
    <insert id="insertDailyAccuracyBatch" parameterType="java.util.List">
        INSERT INTO accuracy_daily
        (source, location_name, latitude, longitude, forecast_time_utc, target_date, forecast_horizon,
         temperature_min_mae, temperature_max_mae, temperature_mean_mae,
         temperature_min_bias, temperature_max_bias, temperature_mean_bias,
         precipitation_mae, precipitation_bias, wind_speed_mae, wind_speed_bias)
        VALUES
        <foreach collection="list" item="entity" separator=",">
            (#{entity.source}, #{entity.locationName}, #{entity.latitude}, #{entity.longitude},
             #{entity.forecastTimeUtc}, #{entity.targetDate}, #{entity.forecastHorizon},
             #{entity.temperatureMinMae}, #{entity.temperatureMaxMae}, #{entity.temperatureMeanMae},
             #{entity.temperatureMinBias}, #{entity.temperatureMaxBias}, #{entity.temperatureMeanBias},
             #{entity.precipitationMae}, #{entity.precipitationBias}, #{entity.windSpeedMae}, #{entity.windSpeedBias})
        </foreach>
    </insert>

    <!-- Count records for monitoring -->
    <select id="countHourlyAccuracyRecords" resultType="java.lang.Long">
        SELECT COUNT(*) FROM accuracy_hourly
    </select>

    <select id="countDailyAccuracyRecords" resultType="java.lang.Long">
        SELECT COUNT(*) FROM accuracy_daily
    </select>

</mapper>